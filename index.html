<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>School Barcode Scanner Log</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <div class="container">
    <h2>ðŸŽ“ School Barcode Scanner Log (Google Sheets Connected)</h2>
    <p>Allow camera access when prompted.</p>

    <div class="input-section">
      <label for="nameInput"><b>Enter Name:</b></label>
      <input type="text" id="nameInput" placeholder="Type your name...">
    </div>

    <div id="reader"></div>

    <h3>ðŸ“‹ Scan Log</h3>
    <div class="table-container">
      <table id="log">
        <tr>
          <th>Name</th>
          <th>ID Number</th>
          <th>Date</th>
          <th>Time</th>
        </tr>
      </table>
    </div>
  </div>

  <script>
    // ðŸ”— Replace this with your Google Apps Script Web App URL
    const SHEETS_URL = "https://script.google.com/macros/s/AKfycbzmE3cHM6trDqlWnUPhMermHQ0Nww77gNedLSkFH4Rpx5VWOc8YBy8UhEtnQTskKfNh/exec";

    // âœ… Add entry to table and send to Google Sheets
    function addLog(name, idNumber) {
      const now = new Date();
      const date = now.toLocaleDateString();
      const time = now.toLocaleTimeString();

      // Add to local table
      const table = document.getElementById("log");
      const row = table.insertRow(-1);
      row.insertCell(0).textContent = name || "N/A";
      row.insertCell(1).textContent = idNumber;
      row.insertCell(2).textContent = date;
      row.insertCell(3).textContent = time;

      // Send to Google Sheets
      fetch(SHEETS_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: name || "N/A",
          id: idNumber,
          date: date,
          time: time
        })
      });
    }

    // âœ… Called when a barcode is successfully scanned
    function onScanSuccess(decodedText) {
      const name = document.getElementById("nameInput").value.trim();
      const confirmScan = confirm(`Scanned ID: ${decodedText}\n\nConfirm to save this entry?`);
      if (confirmScan) {
        addLog(name, decodedText);
        alert("Scanned successfully!");
      } else {
        alert("Scan cancelled.");
      }
    }

    // âœ… Initialize scanner (optimized for 1D barcodes like CODE_128)
    const html5QrcodeScanner = new Html5QrcodeScanner("reader", { 
      fps: 5, // slower = clearer for 1D barcodes
      qrbox: { width: 400, height: 120 }, // wider, shallower box fits your ID barcode
      rememberLastUsedCamera: true,
      formatsToSupport: [
        Html5QrcodeSupportedFormats.CODE_128,
        Html5QrcodeSupportedFormats.CODE_39,
        Html5QrcodeSupportedFormats.EAN_13
      ]
    });

    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>
